<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香港貨幣計算練習</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS 用於樣式 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eff6ff;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 內建圖示組件 (取代外部依賴) ---
        const Coins = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>
        );
        const Trophy = ({ size, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size || 24} height={size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
        );
        const CheckCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );
        const XCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
        );
        const RefreshCw = ({ size, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size || 24} height={size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );

        // --- 貨幣組件 ---

        const CurrencyNote = ({ value }) => {
            const getStyle = (val) => {
                switch (val) {
                case 1000: return { bg: 'bg-yellow-600', text: 'text-white', label: '1000' };
                case 500: return { bg: 'bg-yellow-800', text: 'text-white', label: '500' };
                case 100: return { bg: 'bg-red-500', text: 'text-white', label: '100' };
                case 50: return { bg: 'bg-green-500', text: 'text-white', label: '50' };
                case 20: return { bg: 'bg-blue-500', text: 'text-white', label: '20' };
                case 10: return { bg: 'bg-purple-500', text: 'text-white', label: '10' };
                default: return { bg: 'bg-gray-400', text: 'text-black', label: '?' };
                }
            };

            const style = getStyle(value);

            return (
                <div className={`${style.bg} ${style.text} w-24 h-14 rounded shadow-md flex items-center justify-center m-1 border-2 border-opacity-20 border-white relative transform transition hover:scale-105 select-none`}>
                <div className="absolute top-1 left-2 text-xs font-bold">{style.label}</div>
                <div className="absolute bottom-1 right-2 text-xs font-bold">{style.label}</div>
                <div className="font-bold text-xl">{style.label}</div>
                <div className="absolute text-[8px] opacity-70 bottom-1 left-2">港幣</div>
                </div>
            );
        };

        const CurrencyCoin = ({ value }) => {
            const getStyle = (val) => {
                const v = Math.round(val * 10) / 10;
                switch (v) {
                case 10: return { size: 'w-16 h-16', bg: 'bg-yellow-100', border: 'border-yellow-600', text: 'text-yellow-800', label: '10', inner: true };
                case 5: return { size: 'w-14 h-14', bg: 'bg-gray-300', border: 'border-gray-400', text: 'text-gray-700', label: '5', thick: true };
                case 2: return { size: 'w-12 h-12', bg: 'bg-gray-300', border: 'border-gray-400', text: 'text-gray-700', label: '2', wavy: true };
                case 1: return { size: 'w-10 h-10', bg: 'bg-gray-200', border: 'border-gray-300', text: 'text-gray-600', label: '1' };
                case 0.5: return { size: 'w-9 h-9', bg: 'bg-yellow-600', border: 'border-yellow-700', text: 'text-yellow-100', label: '5毫' };
                case 0.2: return { size: 'w-8 h-8', bg: 'bg-yellow-600', border: 'border-yellow-700', text: 'text-yellow-100', label: '2毫', wavy: true };
                case 0.1: return { size: 'w-6 h-6', bg: 'bg-yellow-600', border: 'border-yellow-700', text: 'text-yellow-100', label: '1毫' };
                default: return { size: 'w-10 h-10', bg: 'bg-gray-400', border: 'border-gray-500', text: 'text-white', label: '?' };
                }
            };

            const style = getStyle(value);
            const isWavy = style.wavy ? "rounded-[30%]" : "rounded-full";

            return (
                <div className={`${style.size} ${style.bg} ${style.text} border-4 ${style.border} ${isWavy} shadow-sm flex items-center justify-center m-1 font-bold relative transform transition hover:rotate-12 select-none`}>
                {style.inner && <div className="absolute inset-2 border-2 border-yellow-600 rounded-full opacity-50"></div>}
                {style.label}
                </div>
            );
        };

        // --- 主應用程式邏輯 ---

        const generateQuestion = (level) => {
            let notes = [];
            let coins = [];
            
            const r = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const randCount = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            if (level === 1) {
                const noteOpts = [100, 50, 20];
                const coinOpts = [10, 5, 2, 1];
                for (let i = 0; i < randCount(2, 4); i++) notes.push(r(noteOpts));
                for (let i = 0; i < randCount(1, 3); i++) coins.push(r(coinOpts));
            } else if (level === 2) {
                const noteOpts = [500, 100, 50, 20];
                const coinOpts = [10, 5, 2, 1, 0.5];
                for (let i = 0; i < randCount(2, 5); i++) notes.push(r(noteOpts));
                for (let i = 0; i < randCount(2, 5); i++) coins.push(r(coinOpts));
            } else {
                const noteOpts = [1000, 500, 100, 50, 20];
                const coinOpts = [10, 5, 2, 1, 0.5, 0.2, 0.1];
                for (let i = 0; i < randCount(3, 6); i++) notes.push(r(noteOpts));
                for (let i = 0; i < randCount(3, 8); i++) coins.push(r(coinOpts));
            }

            notes.sort((a, b) => b - a);
            coins.sort((a, b) => b - a);

            let total = notes.reduce((a, b) => a + b, 0) + coins.reduce((a, b) => a + b, 0);
            total = Math.round(total * 10) / 10;

            const dollars = Math.floor(total);
            const cents = Math.round((total - dollars) * 10);

            return {
                id: Date.now(),
                notes,
                coins,
                correctDollars: dollars,
                correctCents: cents,
                totalValue: total
            };
        };

        function HKCurrencyWorksheet() {
            const [level, setLevel] = useState(1);
            const [question, setQuestion] = useState(null);
            const [inputDollars, setInputDollars] = useState('');
            const [inputCents, setInputCents] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);

            useEffect(() => {
                newQuestion();
            }, [level]);

            const newQuestion = () => {
                setQuestion(generateQuestion(level));
                setInputDollars('');
                setInputCents('');
                setFeedback(null);
            };

            const checkAnswer = () => {
                if (!question) return;

                const userD = parseInt(inputDollars) || 0;
                const userC = parseInt(inputCents) || 0;

                if (userD === question.correctDollars && userC === question.correctCents) {
                    setFeedback('correct');
                    setScore(s => s + 10 * level);
                    setStreak(s => s + 1);
                } else {
                    setFeedback('incorrect');
                    setStreak(0);
                }
            };

            const handleLevelChange = (newLevel) => {
                setLevel(newLevel);
                setScore(0);
                setStreak(0);
            };

            if (!question) return <div className="p-10 text-center">載入中...</div>;

            return (
                <div className="min-h-screen bg-blue-50 font-sans text-gray-800 p-4 md:p-8">
                <div className="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
                    
                    {/* Header */}
                    <div className="bg-blue-600 p-4 text-white flex justify-between items-center">
                    <div className="flex items-center gap-2">
                        <Coins className="w-6 h-6" />
                        <h1 className="text-xl font-bold">香港貨幣計算練習</h1>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="flex flex-col items-end">
                        <span className="text-sm opacity-80">分數</span>
                        <span className="font-bold text-lg">{score}</span>
                        </div>
                        {streak > 1 && (
                        <div className="flex flex-col items-end text-yellow-300">
                            <span className="text-sm opacity-80 flex items-center gap-1"><Trophy size={12}/> 連對</span>
                            <span className="font-bold text-lg">{streak}</span>
                        </div>
                        )}
                    </div>
                    </div>

                    {/* Level Selector */}
                    <div className="flex justify-center gap-2 p-4 bg-gray-50 border-b">
                    {[1, 2, 3].map(l => (
                        <button
                        key={l}
                        onClick={() => handleLevelChange(l)}
                        className={`px-4 py-1 rounded-full text-sm font-medium transition ${
                            level === l 
                            ? 'bg-blue-500 text-white shadow-md' 
                            : 'bg-white text-gray-600 border hover:bg-gray-100'
                        }`}
                        >
                        等級 {l}
                        </button>
                    ))}
                    </div>

                    {/* Game Area */}
                    <div className="p-6">
                    <h2 className="text-lg font-bold text-gray-700 mb-4 text-center">
                        找出下列貨幣的總值
                    </h2>

                    {/* Money Display */}
                    <div className="bg-gray-100 p-6 rounded-xl min-h-[200px] flex flex-wrap content-start gap-2 justify-center mb-8 border-inner">
                        {question.notes.map((val, idx) => (
                        <CurrencyNote key={`n-${idx}`} value={val} />
                        ))}
                        {question.coins.map((val, idx) => (
                        <CurrencyCoin key={`c-${idx}`} value={val} />
                        ))}
                    </div>

                    {/* Input Area */}
                    <div className="flex flex-col items-center gap-6">
                        <div className="flex items-end gap-3 text-xl font-bold">
                        <div className="flex flex-col items-center">
                            <label className="text-sm text-gray-500 mb-1">元</label>
                            <input
                            type="number"
                            inputMode="numeric"
                            value={inputDollars}
                            onChange={(e) => setInputDollars(e.target.value)}
                            disabled={feedback === 'correct'}
                            className="w-24 h-12 text-center border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-2xl"
                            placeholder="0"
                            />
                        </div>
                        <span className="pb-2 text-gray-400">元</span>
                        
                        <div className="flex flex-col items-center">
                            <label className="text-sm text-gray-500 mb-1">角</label>
                            <input
                            type="number"
                            inputMode="numeric"
                            value={inputCents}
                            onChange={(e) => setInputCents(e.target.value)}
                            disabled={feedback === 'correct'}
                            className="w-20 h-12 text-center border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-2xl"
                            placeholder="0"
                            />
                        </div>
                        <span className="pb-2 text-gray-400">角</span>
                        </div>

                        {/* Actions & Feedback */}
                        <div className="w-full flex flex-col items-center gap-4">
                        {feedback === null ? (
                            <button
                            onClick={checkAnswer}
                            className="w-full max-w-xs bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2"
                            >
                            檢查答案
                            </button>
                        ) : (
                            <div className={`w-full p-4 rounded-xl flex items-center justify-between ${
                            feedback === 'correct' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }`}>
                            <div className="flex items-center gap-3">
                                {feedback === 'correct' ? <CheckCircle className="w-8 h-8"/> : <XCircle className="w-8 h-8"/>}
                                <div>
                                <p className="font-bold text-lg">
                                    {feedback === 'correct' ? '答對了！太棒了！' : '再試一次！'}
                                </p>
                                {feedback === 'incorrect' && (
                                    <p className="text-sm mt-1">
                                    提示：再仔細數數看喔。
                                    </p>
                                )}
                                </div>
                            </div>
                            
                            {feedback === 'correct' ? (
                                <button
                                onClick={newQuestion}
                                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold shadow flex items-center gap-2"
                                >
                                下一題 <RefreshCw size={16}/>
                                </button>
                            ) : (
                                <button
                                onClick={() => setFeedback(null)}
                                className="bg-white border border-red-300 text-red-700 px-4 py-2 rounded-lg font-bold hover:bg-red-50"
                                >
                                重試
                                </button>
                            )}
                            </div>
                        )}
                        </div>
                    </div>
                    </div>

                    {/* Footer */}
                    <div className="bg-gray-50 p-4 text-center text-xs text-gray-500">
                    參考貨幣工作紙內容製作 • 適合小學數學輔助練習
                    </div>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HKCurrencyWorksheet />);
    </script>
</body>
</html>